<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="å½©é¹"><meta name="copyright" content="å½©é¹"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>React - Redux | å½©é¹çš„å°ç«™</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"blog.gaocaipeng.com","root":"/","title":"å½©é¹çš„å°ç«™","version":"1.6.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="ä»€ä¹ˆæ˜¯ reduxRedux æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript æ¡†æ¶ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªå¯é¢„æµ‹çš„çŠ¶æ€å®¹å™¨ã€‚Redux åŸºäºç®€åŒ–ç‰ˆæœ¬çš„ Flux æ¡†æ¶ï¼ŒFlux æ˜¯ Facebook å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ã€‚åœ¨æ ‡å‡†çš„ MVC æ¡†æ¶ä¸­ï¼Œæ•°æ®å¯ä»¥åœ¨ UI ç»„ä»¶å’Œå­˜å‚¨ä¹‹é—´åŒå‘æµåŠ¨ï¼Œè€Œ Redux ä¸¥æ ¼é™åˆ¶äº†æ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ åŠ¨æœºéšç€ JavaScript å•é¡µåº”ç”¨å¼€å‘æ—¥è¶‹å¤æ‚ï¼ŒJavaScript éœ€è¦">
<meta property="og:type" content="article">
<meta property="og:title" content="React - Redux">
<meta property="og:url" content="https://blog.gaocaipeng.com/2020/06/28/ufmyxp/index.html">
<meta property="og:site_name" content="å½©é¹çš„å°ç«™">
<meta property="og:description" content="ä»€ä¹ˆæ˜¯ reduxRedux æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript æ¡†æ¶ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªå¯é¢„æµ‹çš„çŠ¶æ€å®¹å™¨ã€‚Redux åŸºäºç®€åŒ–ç‰ˆæœ¬çš„ Flux æ¡†æ¶ï¼ŒFlux æ˜¯ Facebook å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ã€‚åœ¨æ ‡å‡†çš„ MVC æ¡†æ¶ä¸­ï¼Œæ•°æ®å¯ä»¥åœ¨ UI ç»„ä»¶å’Œå­˜å‚¨ä¹‹é—´åŒå‘æµåŠ¨ï¼Œè€Œ Redux ä¸¥æ ¼é™åˆ¶äº†æ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ åŠ¨æœºéšç€ JavaScript å•é¡µåº”ç”¨å¼€å‘æ—¥è¶‹å¤æ‚ï¼ŒJavaScript éœ€è¦">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449857357-dd25106d-4ac2-4c50-9d71-80807411afaa.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=LCVTP&originHeight=330&originWidth=687&originalType=binary%E2%88%B6=1&status=done&style=none">
<meta property="og:image" content="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449895739-f967e699-389d-4091-9216-97e2a2b207fe.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=VdoDb&originHeight=113&originWidth=214&originalType=binary%E2%88%B6=1&status=done&style=none">
<meta property="og:image" content="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449910503-48335523-6dfe-45a9-bcbe-0e887ef1ac3c.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=QiN1x&originHeight=243&originWidth=196&originalType=binary%E2%88%B6=1&status=done&style=none">
<meta property="article:published_time" content="2020-06-28T05:19:54.000Z">
<meta property="article:modified_time" content="2022-01-05T02:19:20.684Z">
<meta property="article:author" content="å½©é¹">
<meta property="article:tag" content="Redux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449857357-dd25106d-4ac2-4c50-9d71-80807411afaa.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=LCVTP&originHeight=330&originWidth=687&originalType=binary%E2%88%B6=1&status=done&style=none"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="å½©é¹"><img width="96" loading="lazy" src="/images/atm.webp" alt="å½©é¹"><span class="site-author-status" title="æ°¸è¿œç›¸ä¿¡ç¾å¥½çš„äº‹æƒ…å³å°†å‘ç”Ÿ">ğŸ˜Š</span></a><div class="site-author-name"><a href="/about/">å½©é¹</a></div><a class="site-name" href="/about/site.html">å½©é¹çš„å°ç«™</a><sub class="site-subtitle">All at sea.</sub><div class="site-desciption">å¸Œæœ›èƒ½æˆä¸ºä¸€ä¸ªæœ‰è¶£çš„äºº</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">182</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">28</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">188</span></a></div><a class="site-state-item hty-icon-button" href="/" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/gaocaipeng" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=1309947697" title="ç½‘æ˜“äº‘éŸ³ä¹" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/du-xiao-sheng-dian-a" title="çŸ¥ä¹" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:peng25402@163.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-redux"><span class="toc-number">1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯ redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%9C%BA"><span class="toc-number">2.</span> <span class="toc-text">åŠ¨æœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%AE%A1%E7%90%86%E7%8A%B6%E6%80%81"><span class="toc-number">3.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">4.</span> <span class="toc-text">ä¸‰å¤§åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">4.0.1.</span> <span class="toc-text">å•ä¸€æ•°æ®æº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#State-%E6%98%AF%E5%8F%AA%E8%AF%BB%E7%9A%84"><span class="toc-number">4.0.2.</span> <span class="toc-text">State æ˜¯åªè¯»çš„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BA%AF%E5%87%BD%E6%95%B0%E6%9D%A5%E6%89%A7%E8%A1%8C%E4%BF%AE%E6%94%B9"><span class="toc-number">4.0.3.</span> <span class="toc-text">ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%88%E5%89%8D%E6%8A%80%E6%9C%AF"><span class="toc-number">5.</span> <span class="toc-text">å…ˆå‰æŠ€æœ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F"><span class="toc-number">6.</span> <span class="toc-text">ç”Ÿæ€ç³»ç»Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#react-redux"><span class="toc-number"></span> <span class="toc-text">react-redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%93%E5%BA%93%E7%9A%84%E5%BC%95%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">ä»“åº“çš„å¼•ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%B3%A8%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">é¡µé¢æ³¨å…¥æ•°æ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">è£…é¥°å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">4.1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wepy-redux"><span class="toc-number"></span> <span class="toc-text">wepy-redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-number">1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">ç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-store"><span class="toc-number">3.</span> <span class="toc-text">åˆ›å»º store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-reducer"><span class="toc-number">4.</span> <span class="toc-text">åˆ›å»º reducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-action"><span class="toc-number">5.</span> <span class="toc-text">åˆ›å»º action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-type"><span class="toc-number">6.</span> <span class="toc-text">åˆ›å»º type</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%8F%8A%E7%9B%91%E5%90%AC"><span class="toc-number">7.</span> <span class="toc-text">ç»‘å®šåŠç›‘å¬</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Store"><span class="toc-number"></span> <span class="toc-text">Store</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%8C%E8%B4%A3%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">èŒè´£ï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text">åŸºç¡€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">4.</span> <span class="toc-text">åˆ›å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">é…ç½®åˆå§‹åŒ–æ•°æ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%9B%91%E5%90%AC"><span class="toc-number">6.</span> <span class="toc-text">æ·»åŠ ç›‘å¬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E7%9B%91%E5%90%AC"><span class="toc-number">7.</span> <span class="toc-text">ç§»é™¤ç›‘å¬</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Action"><span class="toc-number"></span> <span class="toc-text">Action</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E8%B5%B7-Action"><span class="toc-number">1.</span> <span class="toc-text">å‘èµ· Action</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reducer"><span class="toc-number"></span> <span class="toc-text">Reducer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.</span> <span class="toc-text">æ³¨æ„äº‹é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">çº¯å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E7%BA%AF%E5%87%BD%E6%95%B0%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF%E5%87%BD%E6%95%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BC%98%E7%82%B9"><span class="toc-number">4.</span> <span class="toc-text">çº¯å‡½æ•°çš„ä¸€äº›ä¼˜ç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6-reducer"><span class="toc-number">5.</span> <span class="toc-text">åˆå¹¶ reducer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">éœ€æ±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">æºç å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#store-index-js"><span class="toc-number">6.0.1.</span> <span class="toc-text">store&#x2F;index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-number">6.0.2.</span> <span class="toc-text">é¡µé¢çš„è°ƒç”¨</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://blog.gaocaipeng.com/2020/06/28/ufmyxp/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="å½©é¹"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="å½©é¹çš„å°ç«™"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">React - Redux</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2020-06-28 05:19:54" itemprop="dateCreated datePublished" datetime="2020-06-28T05:19:54+00:00">2020-06-28</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2022-01-05 02:19:20" itemprop="dateModified" datetime="2022-01-05T02:19:20+00:00">2022-01-05</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/React/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">React</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/React/Redux/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Redux</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Redux/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Redux</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="ä»€ä¹ˆæ˜¯-redux"><a href="#ä»€ä¹ˆæ˜¯-redux" class="headerlink" title="ä»€ä¹ˆæ˜¯ redux"></a>ä»€ä¹ˆæ˜¯ redux</h2><p>Redux æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript æ¡†æ¶ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªå¯é¢„æµ‹çš„çŠ¶æ€å®¹å™¨ã€‚Redux åŸºäºç®€åŒ–ç‰ˆæœ¬çš„ Flux æ¡†æ¶ï¼ŒFlux æ˜¯ Facebook å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ã€‚åœ¨æ ‡å‡†çš„ MVC æ¡†æ¶ä¸­ï¼Œæ•°æ®å¯ä»¥åœ¨ UI ç»„ä»¶å’Œå­˜å‚¨ä¹‹é—´åŒå‘æµåŠ¨ï¼Œè€Œ Redux ä¸¥æ ¼é™åˆ¶äº†æ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨<br><img src="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449857357-dd25106d-4ac2-4c50-9d71-80807411afaa.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=LCVTP&originHeight=330&originWidth=687&originalType=binary%E2%88%B6=1&status=done&style=none" loading="lazy"></p>
<h2 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h2><p>éšç€ JavaScript å•é¡µåº”ç”¨å¼€å‘æ—¥è¶‹å¤æ‚ï¼ŒJavaScript éœ€è¦ç®¡ç†æ¯”ä»»ä½•æ—¶å€™éƒ½è¦å¤šçš„ state ï¼ˆçŠ¶æ€ï¼‰ã€‚ è¿™äº› state å¯èƒ½åŒ…æ‹¬æœåŠ¡å™¨å“åº”ã€ç¼“å­˜æ•°æ®ã€æœ¬åœ°ç”Ÿæˆå°šæœªæŒä¹…åŒ–åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œä¹ŸåŒ…æ‹¬ UI çŠ¶æ€ï¼Œå¦‚æ¿€æ´»çš„è·¯ç”±ï¼Œè¢«é€‰ä¸­çš„æ ‡ç­¾ï¼Œæ˜¯å¦æ˜¾ç¤ºåŠ è½½åŠ¨æ•ˆæˆ–è€…åˆ†é¡µå™¨ç­‰ç­‰ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€"><a href="#ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€"></a>ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€</h2><p>ç®¡ç†ä¸æ–­å˜åŒ–çš„ state éå¸¸å›°éš¾ã€‚å¦‚æœä¸€ä¸ª model çš„å˜åŒ–ä¼šå¼•èµ·å¦ä¸€ä¸ª model å˜åŒ–ï¼Œé‚£ä¹ˆå½“ view å˜åŒ–æ—¶ï¼Œå°±å¯èƒ½å¼•èµ·å¯¹åº” model ä»¥åŠå¦ä¸€ä¸ª model çš„å˜åŒ–ï¼Œä¾æ¬¡åœ°ï¼Œå¯èƒ½ä¼šå¼•èµ·å¦ä¸€ä¸ª view çš„å˜åŒ–ã€‚ç›´è‡³ä½ æä¸æ¸…æ¥šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚state åœ¨ä»€ä¹ˆæ—¶å€™ï¼Œç”±äºä»€ä¹ˆåŸå› ï¼Œå¦‚ä½•å˜åŒ–å·²ç„¶ä¸å—æ§åˆ¶ã€‚ å½“ç³»ç»Ÿå˜å¾—é”™ç»¼å¤æ‚çš„æ—¶å€™ï¼Œæƒ³é‡ç°é—®é¢˜æˆ–è€…æ·»åŠ æ–°åŠŸèƒ½å°±ä¼šå˜å¾—ä¸¾æ­¥ç»´è‰°ã€‚<br>è·Ÿéš Fluxã€CQRS å’Œ Event Sourcing çš„è„šæ­¥ï¼Œé€šè¿‡é™åˆ¶æ›´æ–°å‘ç”Ÿçš„æ—¶é—´å’Œæ–¹å¼ï¼ŒRedux è¯•å›¾è®© state çš„å˜åŒ–å˜å¾—å¯é¢„æµ‹ã€‚è¿™äº›é™åˆ¶æ¡ä»¶åæ˜ åœ¨ Redux çš„ä¸‰å¤§åŸåˆ™ä¸­ã€‚</p>
<h2 id="ä¸‰å¤§åŸåˆ™"><a href="#ä¸‰å¤§åŸåˆ™" class="headerlink" title="ä¸‰å¤§åŸåˆ™"></a>ä¸‰å¤§åŸåˆ™</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redux å¯ä»¥ç”¨è¿™ä¸‰ä¸ªåŸºæœ¬åŸåˆ™æ¥æè¿°ï¼š</span><br></pre></td></tr></table></figure>

<h4 id="å•ä¸€æ•°æ®æº"><a href="#å•ä¸€æ•°æ®æº" class="headerlink" title="å•ä¸€æ•°æ®æº"></a>å•ä¸€æ•°æ®æº</h4><p>æ•´ä¸ªåº”ç”¨çš„ state è¢«å‚¨å­˜åœ¨ä¸€æ£µ object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª store ä¸­ã€‚<br>è¿™è®©åŒæ„åº”ç”¨å¼€å‘å˜å¾—éå¸¸å®¹æ˜“ã€‚æ¥è‡ªæœåŠ¡ç«¯çš„ state å¯ä»¥åœ¨æ— éœ€ç¼–å†™æ›´å¤šä»£ç çš„æƒ…å†µä¸‹è¢«åºåˆ—åŒ–å¹¶æ³¨å…¥åˆ°å®¢æˆ·ç«¯ä¸­ã€‚ç”±äºæ˜¯å•ä¸€çš„ state tree ï¼Œè°ƒè¯•ä¹Ÿå˜å¾—éå¸¸å®¹æ˜“ã€‚åœ¨å¼€å‘ä¸­ï¼Œä½ å¯ä»¥æŠŠåº”ç”¨çš„ state ä¿å­˜åœ¨æœ¬åœ°ï¼Œä»è€ŒåŠ å¿«å¼€å‘é€Ÿåº¦ã€‚æ­¤å¤–ï¼Œå—ç›Šäºå•ä¸€çš„ state tree ï¼Œä»¥å‰éš¾ä»¥å®ç°çš„å¦‚â€œæ’¤é”€/é‡åšâ€è¿™ç±»åŠŸèƒ½ä¹Ÿå˜å¾—è½»è€Œæ˜“ä¸¾ã€‚<br>console.log(store.getState())<br>/_ è¾“å‡º { visibilityFilter: â€˜SHOW_ALLâ€™, todos: [ { text: â€˜Consider using Reduxâ€™, completed: true, }, { text: â€˜Keep all state in a single treeâ€™, completed: false } ] } _ï¼</p>
<h4 id="State-æ˜¯åªè¯»çš„"><a href="#State-æ˜¯åªè¯»çš„" class="headerlink" title="State æ˜¯åªè¯»çš„"></a>State æ˜¯åªè¯»çš„</h4><p>å”¯ä¸€æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯è§¦å‘ actionï¼Œaction æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚<br>è¿™æ ·ç¡®ä¿äº†è§†å›¾å’Œç½‘ç»œè¯·æ±‚éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Œç›¸åå®ƒä»¬åªèƒ½è¡¨è¾¾æƒ³è¦ä¿®æ”¹çš„æ„å›¾ã€‚å› ä¸ºæ‰€æœ‰çš„ä¿®æ”¹éƒ½è¢«é›†ä¸­åŒ–å¤„ç†ï¼Œä¸”ä¸¥æ ¼æŒ‰ç…§ä¸€ä¸ªæ¥ä¸€ä¸ªçš„é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒ race condition çš„å‡ºç°ã€‚ Action å°±æ˜¯æ™®é€šå¯¹è±¡è€Œå·²ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥è¢«æ—¥å¿—æ‰“å°ã€åºåˆ—åŒ–ã€å‚¨å­˜ã€åæœŸè°ƒè¯•æˆ–æµ‹è¯•æ—¶å›æ”¾å‡ºæ¥ã€‚<br>store.dispatch({ type: â€˜COMPLETE_TODOâ€™, index: 1 })<br>store.dispatch({ type: â€˜SET_VISIBILITY_FILTERâ€™, filter: â€˜SHOW_COMPLETEDâ€™ })</p>
<h4 id="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹"><a href="#ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹" class="headerlink" title="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹"></a>ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹</h4><p>ä¸ºäº†æè¿° action å¦‚ä½•æ”¹å˜ state tree ï¼Œä½ éœ€è¦ç¼–å†™ reducersã€‚<br>Reducer åªæ˜¯ä¸€äº›çº¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶å…ˆå‰çš„ state å’Œ actionï¼Œå¹¶è¿”å›æ–°çš„ stateã€‚åˆšå¼€å§‹ä½ å¯ä»¥åªæœ‰ä¸€ä¸ª reducerï¼Œéšç€åº”ç”¨å˜å¤§ï¼Œä½ å¯ä»¥æŠŠå®ƒæ‹†æˆå¤šä¸ªå°çš„ reducersï¼Œåˆ†åˆ«ç‹¬ç«‹åœ°æ“ä½œ state tree çš„ä¸åŒéƒ¨åˆ†ï¼Œå› ä¸º reducer åªæ˜¯å‡½æ•°ï¼Œä½ å¯ä»¥æ§åˆ¶å®ƒä»¬è¢«è°ƒç”¨çš„é¡ºåºï¼Œä¼ å…¥é™„åŠ æ•°æ®ï¼Œç”šè‡³ç¼–å†™å¯å¤ç”¨çš„ reducer æ¥å¤„ç†ä¸€äº›é€šç”¨ä»»åŠ¡ï¼Œå¦‚åˆ†é¡µå™¨ã€‚<br>function visibilityFilter(state = â€˜SHOW_ALLâ€™, action) { switch (action.type) { case â€˜SET_VISIBILITY_FILTERâ€™: return action.filter default: return state } }<br>function todos(state = [], action) { switch (action.type) { case â€˜ADD_TODOâ€™: return [ â€¦state, { text: action.text, completed: false } ] case â€˜COMPLETE_TODOâ€™: return state.map((todo, index) =&gt; { if (index === action.index) { return Object.assign({}, todo, { completed: true }) } return todo }) default: return state } }<br>import { combineReducers, createStore } from â€˜reduxâ€™ let reducer = combineReducers({ visibilityFilter, todos }) let store = createStore(reducer) å°±æ˜¯è¿™æ ·ï¼Œç°åœ¨ä½ åº”è¯¥æ˜ç™½ Redux æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚</p>
<h2 id="å…ˆå‰æŠ€æœ¯"><a href="#å…ˆå‰æŠ€æœ¯" class="headerlink" title="å…ˆå‰æŠ€æœ¯"></a>å…ˆå‰æŠ€æœ¯</h2><p>Redux æ˜¯ä¸€ä¸ªæ··åˆäº§ç‰©ã€‚å®ƒå’Œä¸€äº›è®¾è®¡æ¨¡å¼åŠæŠ€æœ¯ç›¸ä¼¼ï¼Œä½†ä¹Ÿæœ‰ä¸åŒä¹‹å¤„ã€‚è®©æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹è¿™äº›ç›¸ä¼¼ä¸ä¸åŒã€‚<br>Flux Redux å¯ä»¥è¢«çœ‹ä½œ Flux çš„ä¸€ç§å®ç°å—ï¼Ÿ æ˜¯ï¼Œä¹Ÿå¯ä»¥è¯´ ä¸æ˜¯ã€‚<br>ï¼ˆåˆ«æ‹…å¿ƒï¼Œå®ƒå¾—åˆ°äº† Flux ä½œè€…çš„è®¤å¯ï¼Œå¦‚æœä½ æƒ³ç¡®è®¤ã€‚ï¼‰<br>Redux çš„çµæ„Ÿæ¥æºäº Flux çš„å‡ ä¸ªé‡è¦ç‰¹æ€§ã€‚å’Œ Flux ä¸€æ ·ï¼ŒRedux è§„å®šï¼Œå°†æ¨¡å‹çš„æ›´æ–°é€»è¾‘å…¨éƒ¨é›†ä¸­äºä¸€ä¸ªç‰¹å®šçš„å±‚ï¼ˆFlux é‡Œçš„ storeï¼ŒRedux é‡Œçš„ reducerï¼‰ã€‚Flux å’Œ Redux éƒ½ä¸å…è®¸ç¨‹åºç›´æ¥ä¿®æ”¹æ•°æ®ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªå«ä½œ â€œactionâ€ çš„æ™®é€šå¯¹è±¡æ¥å¯¹æ›´æ”¹è¿›è¡Œæè¿°ã€‚<br>è€Œä¸åŒäº Flux ï¼ŒRedux å¹¶æ²¡æœ‰ dispatcher çš„æ¦‚å¿µã€‚åŸå› æ˜¯å®ƒä¾èµ–çº¯å‡½æ•°æ¥æ›¿ä»£äº‹ä»¶å¤„ç†å™¨ã€‚çº¯å‡½æ•°æ„å»ºç®€å•ï¼Œä¹Ÿä¸éœ€é¢å¤–çš„å®ä½“æ¥ç®¡ç†å®ƒä»¬ã€‚ä½ å¯ä»¥å°†è¿™ç‚¹çœ‹ä½œè¿™ä¸¤ä¸ªæ¡†æ¶çš„å·®å¼‚æˆ–ç»†èŠ‚å®ç°ï¼Œå–å†³äºä½ æ€ä¹ˆçœ‹ Fluxã€‚Flux å¸¸å¸¸è¢«è¡¨è¿°ä¸º (state, action) =&gt; stateã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼ŒRedux æ— ç–‘æ˜¯ Flux æ¶æ„çš„å®ç°ï¼Œä¸”å¾—ç›Šäºçº¯å‡½æ•°è€Œæ›´ä¸ºç®€å•ã€‚<br>å’Œ Flux çš„å¦ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼Œæ˜¯ Redux è®¾æƒ³ä½ æ°¸è¿œä¸ä¼šå˜åŠ¨ä½ çš„æ•°æ®ã€‚ä½ å¯ä»¥å¾ˆå¥½åœ°ä½¿ç”¨æ™®é€šå¯¹è±¡å’Œæ•°ç»„æ¥ç®¡ç† state ï¼Œè€Œä¸æ˜¯åœ¨å¤šä¸ª reducer é‡Œå˜åŠ¨æ•°æ®ã€‚æ­£ç¡®ä¸”ç®€ä¾¿çš„æ–¹å¼æ˜¯ï¼Œä½ åº”è¯¥åœ¨ reducer ä¸­è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡æ¥æ›´æ–° stateï¼Œ åŒæ—¶é…åˆ object spread è¿ç®—ç¬¦ææ¡ˆ æˆ–ä¸€äº›åº“ï¼Œå¦‚ Immutableã€‚<br>è™½ç„¶å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œå†™ä¸çº¯çš„ reducer æ¥å˜åŠ¨æ•°æ®åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†æˆ‘ä»¬å¹¶ä¸é¼“åŠ±è¿™ä¹ˆåšã€‚ä¸çº¯çš„ reducer ä¼šä½¿ä¸€äº›å¼€å‘ç‰¹æ€§ï¼Œå¦‚æ—¶é—´æ—…è¡Œã€è®°å½•/å›æ”¾æˆ–çƒ­åŠ è½½ä¸å¯å®ç°ã€‚æ­¤å¤–ï¼Œåœ¨å¤§éƒ¨åˆ†å®é™…åº”ç”¨ä¸­ï¼Œè¿™ç§æ•°æ®ä¸å¯å˜åŠ¨çš„ç‰¹æ€§å¹¶ä¸ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œå°±åƒ Om æ‰€è¡¨ç°çš„ï¼Œå³ä½¿å¯¹è±¡åˆ†é…å¤±è´¥ï¼Œä»å¯ä»¥é˜²æ­¢æ˜‚è´µçš„é‡æ¸²æŸ“å’Œé‡è®¡ç®—ã€‚è€Œå¾—ç›Šäº reducer çš„çº¯åº¦ï¼Œåº”ç”¨å†…çš„å˜åŒ–æ›´æ˜¯ä¸€ç›®äº†ç„¶ã€‚<br>Elm Elm æ˜¯ä¸€ç§å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œç”± Evan Czaplicki å— Haskell è¯­è¨€çš„å¯å‘å¼€å‘ã€‚å®ƒæ‰§è¡Œä¸€ç§ â€œmodel view updateâ€ çš„æ¶æ„ ï¼Œæ›´æ–°éµå¾ª (state, action) =&gt; state çš„è§„åˆ™ã€‚ Elm çš„ â€œupdaterâ€ ä¸ Redux é‡Œçš„ reducer æœåŠ¡äºç›¸åŒçš„ç›®çš„ã€‚<br>ä¸åŒäº Reduxï¼ŒElm æ˜¯ä¸€é—¨è¯­è¨€ï¼Œå› æ­¤å®ƒåœ¨æ‰§è¡Œçº¯åº¦ï¼Œé™æ€ç±»å‹ï¼Œä¸å¯å˜åŠ¨æ€§ï¼Œaction å’Œæ¨¡å¼åŒ¹é…ç­‰æ–¹é¢æ›´å…·ä¼˜åŠ¿ã€‚å³ä½¿ä½ ä¸æ‰“ç®—ä½¿ç”¨ Elmï¼Œä¹Ÿå¯ä»¥è¯»ä¸€è¯» Elm çš„æ¶æ„ï¼Œå°è¯•ä¸€æŠŠã€‚åŸºäºæ­¤ï¼Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„ä½¿ç”¨ JavaScript åº“å®ç°ç±»ä¼¼æƒ³æ³• çš„é¡¹ç›®ã€‚Redux åº”è¯¥èƒ½ä»ä¸­è·å¾—æ›´å¤šçš„å¯å‘ï¼ ä¸ºäº†æ›´æ¥è¿‘ Elm çš„é™æ€ç±»å‹ï¼ŒRedux å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç±»ä¼¼ Flow çš„æ¸è¿›ç±»å‹è§£å†³æ–¹æ¡ˆ ã€‚<br>Immutable Immutable æ˜¯ä¸€ä¸ªå¯å®ç°æŒä¹…æ•°æ®ç»“æ„çš„ JavaScript åº“ã€‚å®ƒæ€§èƒ½å¾ˆå¥½ï¼Œå¹¶ä¸”å‘½åç¬¦åˆ JavaScript API çš„è¯­è¨€ä¹ æƒ¯ ã€‚<br>Immutable åŠç±»ä¼¼çš„åº“éƒ½å¯ä»¥ä¸ Redux å¯¹æ¥è‰¯å¥½ã€‚å°½å¯éšæ„æ†ç»‘ä½¿ç”¨ï¼<br>Redux å¹¶ä¸åœ¨æ„ä½ å¦‚ä½•å­˜å‚¨ stateï¼Œstate å¯ä»¥æ˜¯æ™®é€šå¯¹è±¡ï¼Œä¸å¯å˜å¯¹è±¡ï¼Œæˆ–è€…å…¶å®ƒç±»å‹ã€‚ ä¸ºäº†ä» server ç«¯å†™åŒæ„åº”ç”¨æˆ–èåˆå®ƒä»¬çš„ state ï¼Œä½ å¯èƒ½è¦ç”¨åˆ°åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„æœºåˆ¶ã€‚ä½†é™¤æ­¤ä»¥å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•æ•°æ®å­˜å‚¨çš„åº“ï¼Œåªè¦å®ƒæ”¯æŒæ•°æ®çš„ä¸å¯å˜åŠ¨æ€§ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œå¯¹äº Redux state ï¼ŒBackbone å¹¶æ— æ„ä¹‰ï¼Œå› ä¸º Backbone model æ˜¯å¯å˜çš„ã€‚<br>æ³¨æ„ï¼Œå³ä¾¿ä½ ä½¿ç”¨æ”¯æŒ cursor çš„ä¸å¯å˜åº“ï¼Œä¹Ÿä¸åº”åœ¨ Redux çš„åº”ç”¨ä¸­ä½¿ç”¨ã€‚æ•´ä¸ª state tree åº”è¢«è§†ä¸ºåªè¯»ï¼Œå¹¶éœ€é€šè¿‡ Redux æ¥æ›´æ–° state å’Œè®¢é˜…æ›´æ–°ã€‚å› æ­¤ï¼Œé€šè¿‡ cursor æ¥æ”¹å†™ï¼Œå¯¹ Redux æ¥è¯´æ²¡æœ‰æ„ä¹‰ã€‚è€Œå¦‚æœåªæ˜¯æƒ³ç”¨ cursor æŠŠ state tree ä» UI tree è§£è€¦å¹¶é€æ­¥ç»†åŒ– cursorï¼Œåº”ä½¿ç”¨ selector æ¥æ›¿ä»£ã€‚ Selector æ˜¯å¯ç»„åˆçš„ getter å‡½æ•°ç»„ã€‚å…·ä½“å¯å‚è€ƒ reselectï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜ç§€ã€ç®€æ´çš„å¯ç»„åˆ selector çš„å®ç°ã€‚<br>Baobab Baobab æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„åº“ï¼Œå®ç°äº†æ•°æ®ä¸å¯å˜ç‰¹æ€§çš„ APIï¼Œç”¨ä»¥æ›´æ–°çº¯ JavaScript å¯¹è±¡ã€‚ä½ å½“ç„¶å¯ä»¥åœ¨ Redux ä¸­ä½¿ç”¨å®ƒï¼Œä½†ä¸¤è€…ä¸€èµ·ä½¿ç”¨å¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿ã€‚<br>Baobab æ‰€æä¾›çš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½ä¸ä½¿ç”¨ cursors æ›´æ–°æ•°æ®ç›¸å…³ï¼Œè€Œ Redux æ›´æ–°æ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯åˆ†å‘ä¸€ä¸ª action ã€‚å¯è§ï¼Œä¸¤è€…ç”¨ä¸åŒæ–¹æ³•ï¼Œè§£å†³çš„å´æ˜¯åŒæ ·çš„é—®é¢˜ï¼Œç›¸äº’å¹¶æ— å¢ç›Šã€‚<br>ä¸åŒäº Immutable ï¼ŒBaobab åœ¨å¼•æ“ä¸‹è¿˜ä¸èƒ½å®ç°ä»»ä½•ç‰¹åˆ«æœ‰æ•ˆçš„æ•°æ®ç»“æ„ï¼ŒåŒæ—¶ä½¿ç”¨ Baobab å’Œ Redux å¹¶æ— è£¨ç›Šã€‚è¿™ç§æƒ…å½¢ä¸‹ï¼Œä½¿ç”¨æ™®é€šå¯¹è±¡ä¼šæ›´ç®€ä¾¿ã€‚<br>Rx Reactive Extensions (å’Œå®ƒä»¬æ­£åœ¨è¿›è¡Œçš„ ç°ä»£åŒ–é‡å†™) æ˜¯ç®¡ç†å¤æ‚å¼‚æ­¥åº”ç”¨éå¸¸ä¼˜ç§€çš„æ–¹æ¡ˆã€‚ä»¥å¤–ï¼Œè¿˜æœ‰è‡´åŠ›äºæ„å»ºå°†äººæœºäº¤äº’ä½œæ¨¡æ‹Ÿä¸ºç›¸äº’ä¾èµ–çš„å¯è§‚æµ‹å˜é‡çš„åº“ã€‚<br>åŒæ—¶ä½¿ç”¨å®ƒå’Œ Redux æœ‰æ„ä¹‰ä¹ˆï¼Ÿå½“ç„¶ï¼å®ƒä»¬é…åˆå¾—å¾ˆå¥½ã€‚å°† Redux store è§†ä½œå¯è§‚å¯Ÿå˜é‡éå¸¸ç®€ä¾¿ï¼Œä¾‹å¦‚ï¼š<br>function toObservable(store) { return { subscribe({ next }) { const unsubscribe = store.subscribe(() =&gt; next(store.getState())) next(store.getState()) return { unsubscribe } } } } ä½¿ç”¨ç±»ä¼¼æ–¹æ³•ï¼Œä½ å¯ä»¥ç»„åˆä¸åŒçš„å¼‚æ­¥æµï¼Œå°†å…¶è½¬åŒ–ä¸º action ï¼Œå†æäº¤åˆ° store.dispatch() ã€‚<br>é—®é¢˜åœ¨äº: åœ¨å·²ç»ä½¿ç”¨äº† Rx çš„æƒ…å†µä¸‹ï¼Œä½ çœŸçš„éœ€è¦ Redux å—ï¼Ÿ ä¸ä¸€å®šã€‚é€šè¿‡ Rx é‡æ–°å®ç° Redux å¹¶ä¸éš¾ã€‚æœ‰äººè¯´ä»…éœ€ä½¿ç”¨ä¸€ä¸¤å¥çš„ .scan() æ–¹æ³•å³å¯ã€‚è¿™ç§åšæ³•è¯´ä¸å®šä¸é”™ï¼<br>å¦‚æœä½ ä»æœ‰ç–‘è™‘ï¼Œå¯ä»¥å»æŸ¥çœ‹ Redux çš„æºä»£ç  (å¹¶ä¸å¤š) ä»¥åŠç”Ÿæ€ç³»ç»Ÿ (ä¾‹å¦‚å¼€å‘è€…å·¥å…·)ã€‚å¦‚æœä½ æ— æ„äºæ­¤ï¼Œä»åšæŒä½¿ç”¨äº¤äº’æ•°æ®æµï¼Œå¯ä»¥å»æ¢ç´¢ä¸€ä¸‹ Cycle è¿™æ ·çš„åº“ï¼Œæˆ–æŠŠå®ƒåˆå¹¶åˆ° Redux ä¸­ã€‚è®°å¾—å‘Šè¯‰æˆ‘ä»¬å®ƒè¿ä½œå¾—å¦‚ä½•ï¼</p>
<h2 id="ç”Ÿæ€ç³»ç»Ÿ"><a href="#ç”Ÿæ€ç³»ç»Ÿ" class="headerlink" title="ç”Ÿæ€ç³»ç»Ÿ"></a>ç”Ÿæ€ç³»ç»Ÿ</h2><p>Redux æ˜¯ä¸€ä¸ªä½“å°ç²¾æ‚çš„åº“ï¼Œä½†å®ƒç›¸å…³çš„å†…å®¹å’Œ API éƒ½æ˜¯ç²¾æŒ‘ç»†é€‰çš„ï¼Œè¶³ä»¥è¡ç”Ÿå‡ºä¸°å¯Œçš„å·¥å…·é›†å’Œå¯æ‰©å±•çš„ç”Ÿæ€ç³»ç»Ÿã€‚<br>å¦‚æœéœ€è¦å…³äº Redux æ‰€æœ‰å†…å®¹çš„åˆ—è¡¨ï¼Œæ¨èç§»æ­¥è‡³ Awesome Reduxã€‚å®ƒåŒ…å«äº†ç¤ºä¾‹ã€æ ·æ¿ä»£ç ã€ä¸­é—´ä»¶ã€å·¥å…·åº“ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒç›¸å…³å†…å®¹ã€‚è¦æƒ³å­¦ä¹  React å’Œ Redux ï¼ŒReact/Redux Links åŒ…å«äº†æ•™ç¨‹å’Œä¸å°‘æœ‰ç”¨çš„èµ„æºï¼ŒRedux Ecosystem Links åˆ™åˆ—å‡ºäº† è®¸å¤š Redux ç›¸å…³çš„åº“åŠæ’ä»¶ã€‚<br>æœ¬é¡µå°†åªåˆ—å‡ºç”± Redux ç»´æŠ¤è€…å®¡æŸ¥è¿‡çš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚ä¸è¦å› æ­¤æ‰“æ¶ˆå°è¯•å…¶å®ƒå·¥å…·çš„ä¿¡å¿ƒï¼æ•´ä¸ªç”Ÿæ€å‘å±•å¾—å¤ªå¿«ï¼Œæˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å»å…³æ³¨æ‰€æœ‰å†…å®¹ã€‚å»ºè®®åªæŠŠè¿™äº›å½“ä½œâ€œå†…éƒ¨æ¨èâ€ï¼Œå¦‚æœä½ ä½¿ç”¨ Redux åˆ›å»ºäº†å¾ˆé…·çš„å†…å®¹ï¼Œä¸è¦çŠ¹è±«ï¼Œé©¬ä¸Šå‘ä¸ª PR å§ã€‚<br>å­¦ä¹  Redux æ¼”ç¤º å¼€å§‹å­¦ä¹  Redux â€” å‘ä½œè€…å­¦ä¹  Redux åŸºç¡€çŸ¥è¯†ï¼ˆ30 ä¸ªå…è´¹çš„æ•™å­¦è§†é¢‘ï¼‰ å­¦ä¹  Redux â€” æ­å»ºä¸€ä¸ªç®€å•çš„å›¾ç‰‡åº”ç”¨ï¼Œç®€è¦ä½¿ç”¨äº† Reduxã€React Router å’Œ React.js çš„æ ¸å¿ƒæ€æƒ³ ç¤ºä¾‹åº”ç”¨ å®˜æ–¹ç¤ºä¾‹ â€” ä¸€äº›å®˜æ–¹ç¤ºä¾‹ï¼Œæ¶µç›–äº†å¤šç§ Redux æŠ€æœ¯ SoundRedux â€” ç”¨ Redux æ„å»ºçš„ SoundCloud å®¢æˆ·ç«¯ grafgiti â€” åœ¨ä½ çš„ Github çš„ Contributor é¡µä¸Šåˆ›å»º graffiti React-lego â€” å¦‚ä½•åƒç§¯æœ¨ä¸€æ ·ï¼Œä¸€å—å—åœ°æ‰©å±•ä½ çš„ Redux æŠ€æœ¯æ ˆ æ•™ç¨‹ä¸æ–‡ç«  Redux æ•™ç¨‹ Redux Egghead è¯¾ç¨‹ç¬”è®° ä½¿ç”¨ React Native è¿›è¡Œæ•°æ®æ•´åˆ What the Flux?! Letâ€™s Redux. Leveling Up with React: Redux A cartoon intro to Redux Understanding Redux Handcrafting an Isomorphic Redux Application (With Love) Full-Stack Redux Tutorial Getting Started with React, Redux, and Immutable Secure Your React and Redux App with JWT Authentication Understanding Redux Middleware Angular 2 â€” Introduction to Redux Apollo Client: GraphQL with React and Redux Using redux-saga To Simplify Your Growing React Native Codebase Build an Image Gallery Using Redux Saga Working with VK API (in Russian) æ¼”è®²</p>
<h1 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h1><p>å¸®åŠ©ç”¨æˆ·ç®¡ç† store ä¸­çš„çŠ¶æ€</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>cnpm install react-redux â€“save</p>
<h2 id="ä»“åº“çš„å¼•ç”¨"><a href="#ä»“åº“çš„å¼•ç”¨" class="headerlink" title="ä»“åº“çš„å¼•ç”¨"></a>ä»“åº“çš„å¼•ç”¨</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;view&quot;</span>;</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;#app&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="é¡µé¢æ³¨å…¥æ•°æ®"><a href="#é¡µé¢æ³¨å…¥æ•°æ®" class="headerlink" title="é¡µé¢æ³¨å…¥æ•°æ®"></a>é¡µé¢æ³¨å…¥æ•°æ®</h2><p>å†™æ³•ä¸€:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; datalist &#125; = [];</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Children</span> <span class="attr">datalist</span>=<span class="string">&#123;datalist&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Children</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> state.reducer;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;&quot;</span>, payload &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure>

<p>å†™æ³•äºŒ:<br>é€šè¿‡ es7 Decorator è£…é¥°å™¨å®Œæˆ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redex&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> state.reducer;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;&quot;</span>, payload &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">@connect(mapStateToProps, mapDispatchToProps)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; datalist &#125; = [];</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Children</span> <span class="attr">datalist</span>=<span class="string">&#123;datalist&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Children</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h2 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h2><p>decoratorï¼ˆè£…é¥°å™¨ï¼‰æ˜¯ ES7 é‡Œé¢çš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œä½œç”¨äºç±»ã€ç±»å±æ€§\æ–¹æ³•ï¼Œä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªå®ç°ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½çš„æ¥å£ã€‚</p>
<h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>//babel 6.0<br>npm install babel-plugin-transform-decorator â€“save<br>//babel 7.0<br>npm install @babel/plugin-proposal-decorators</p>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>.babelrc</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;presets&quot;</span>: [<span class="string">&#x27;react-app&#x27;</span>],</span><br><span class="line">   <span class="string">&quot;plugins&quot;</span>: [<span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="wepy-redux"><a href="#wepy-redux" class="headerlink" title="wepy-redux"></a>wepy-redux</h1><h2 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>cnpm install redux redux-actions redux-promise wepy-redux â€“save</p>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p><img src="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449895739-f967e699-389d-4091-9216-97e2a2b207fe.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=VdoDb&originHeight=113&originWidth=214&originalType=binary%E2%88%B6=1&status=done&style=none" loading="lazy"><br><img src="https://oss-peng.oss-cn-beijing.aliyuncs.com/blog/1601449910503-48335523-6dfe-45a9-bcbe-0e887ef1ac3c.png?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_6auY5b2p6bmP,color_ef9191,size_30,shadow_100,x_15,y_15#id=QiN1x&originHeight=243&originWidth=196&originalType=binary%E2%88%B6=1&status=done&style=none" loading="lazy"></p>
<h2 id="åˆ›å»º-store"><a href="#åˆ›å»º-store" class="headerlink" title="åˆ›å»º store"></a>åˆ›å»º store</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Reducers <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> promiseMiddleware <span class="keyword">from</span> <span class="string">&quot;redux-promise&quot;</span>;</span><br><span class="line"><span class="comment">//å†™æ³•ä¸€ï¼š</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">configStore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createStore(Reducers, applyMiddleware(promiseMiddleware))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å†™æ³•äºŒ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(Reducers, applyMiddleware(promiseMiddleware))</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»º-reducer"><a href="#åˆ›å»º-reducer" class="headerlink" title="åˆ›å»º reducer"></a>åˆ›å»º reducer</h2><p><strong>rank.js</strong><br>â€‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">  <span class="attr">rankList</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> rankReducer = <span class="function">(<span class="params">state = defaultState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type, payload &#125; = action;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;UPDATE&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">rankList</span>: payload &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rankReducer;</span><br></pre></td></tr></table></figure>

<p><strong>index.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> rankReducer <span class="keyword">from</span> <span class="string">&quot;./rank&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> topListReducer <span class="keyword">from</span> <span class="string">&quot;./toplist&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> searchReducer <span class="keyword">from</span> <span class="string">&quot;./search&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> Reducers = combineReducers(&#123;</span><br><span class="line">   rankReducer,</span><br><span class="line">   topListReducer,</span><br><span class="line">   searchReducer,</span><br><span class="line">   ...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Reducers;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»º-action"><a href="#åˆ›å»º-action" class="headerlink" title="åˆ›å»º action"></a>åˆ›å»º action</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RNAK_UPDATE &#125; <span class="keyword">from</span> <span class="string">&quot;../type/rank&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createAction &#125; <span class="keyword">from</span> <span class="string">&quot;redux-actions&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"><span class="comment">//æ–¹å¼ä¸€:</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: RNAK_UPDATE,</span><br><span class="line">    payload,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹å¼äºŒï¼š</span></span><br><span class="line"><span class="keyword">const</span> getJson = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">await</span> axios.get(url);</span><br><span class="line">  <span class="keyword">return</span> result.data.data.slider;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> update = createAction(RNAK_UPDATE, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url =</span><br><span class="line">    <span class="string">&quot;https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> getJson(url);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»º-type"><a href="#åˆ›å»º-type" class="headerlink" title="åˆ›å»º type"></a>åˆ›å»º type</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RNAK_UPDATE = <span class="string">&quot;UPDATE&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> TOPLIST_UPDATE = <span class="string">&quot;UPDATE&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ç»‘å®šåŠç›‘å¬"><a href="#ç»‘å®šåŠç›‘å¬" class="headerlink" title="ç»‘å®šåŠç›‘å¬"></a>ç»‘å®šåŠç›‘å¬</h2><p>åœ¨ app.wepy æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š<br>import{setStore}fromâ€™wepy-reduxâ€™<br>importstorefromâ€™./storeâ€™<br>setStore(store)<br>setStore()æ˜¯ç”¨æ¥å°†ä»“åº“ä¸­çš„æ•°æ®ç»‘å®šåˆ°é¡µé¢ä¸­<br>ç±»ä¼¼ react-redux ä¸­çš„ <Provider store={store}></Provider>ç»„ä»¶</p>
<h1 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h1><h2 id="èŒè´£ï¼š"><a href="#èŒè´£ï¼š" class="headerlink" title="èŒè´£ï¼š"></a>èŒè´£ï¼š</h2><ul>
<li>action æè¿°â€œå‘ç”Ÿäº†ä»€ä¹ˆâ€çš„ä¸€ä¸ªåŠ¨ä½œï¼Œé€šè¿‡ dispatch æ¥æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œã€‚</li>
<li>reducers æ¥æ ¹æ® action æ›´æ–° state çš„ç”¨æ³•ã€‚</li>
<li>store å°±æ˜¯æŠŠå®ƒä»¬è”ç³»åˆ°ä¸€èµ·çš„å¯¹è±¡</li>
</ul>
<h2 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-æœ‰å‚æ•°æˆ–è€…æ•°æ®éœ€è¦è¢«å¤šä¸ªé¡µé¢å…±äº«çš„æ—¶å€™;</span><br></pre></td></tr></table></figure>

<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ul>
<li>æä¾› createStore() æ–¹æ³•åˆ›å»ºä¸€ä¸ªä»“åº“ï¼›</li>
<li>æä¾› getState() æ–¹æ³•è·å– stateï¼›</li>
<li>æä¾› dispatch(action) æ–¹æ³•æ›´æ–° stateï¼›</li>
<li>é€šè¿‡ subscribe(listener) æ³¨å†Œç›‘å¬å™¨;</li>
<li>é€šè¿‡ unsubscribe(listener) è¿”å›çš„å‡½æ•°æ³¨é”€ç›‘å¬å™¨ã€‚</li>
</ul>
<p><strong>å†æ¬¡å¼ºè°ƒä¸€ä¸‹ Redux åº”ç”¨åªæœ‰ä¸€ä¸ªå•ä¸€çš„ storeã€‚</strong></p>
<h2 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h2><p>å½“éœ€è¦æ‹†åˆ†æ•°æ®å¤„ç†é€»è¾‘æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ reducer ç»„åˆ è€Œä¸æ˜¯åˆ›å»ºå¤šä¸ª storeã€‚ æ ¹æ®å·²æœ‰çš„ reducer æ¥åˆ›å»º store æ˜¯éå¸¸å®¹æ˜“çš„ã€‚ ä½¿ç”¨ combineReducers() å°†å¤šä¸ª reducer åˆå¹¶æˆä¸ºä¸€ä¸ªã€‚<br>ç°åœ¨æˆ‘ä»¬å°†å…¶å¯¼å…¥ï¼Œå¹¶ä¼ é€’ createStore()ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//reducers</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ...Reducer <span class="keyword">from</span> somepath;</span><br><span class="line"><span class="keyword">import</span> ...Reducer <span class="keyword">from</span> somepath;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Reducers = combineReducers(&#123;</span><br><span class="line">  ...Reducer,</span><br><span class="line">  ...Reducer,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Reducers <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(Reducers)</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®åˆå§‹åŒ–æ•°æ®"><a href="#é…ç½®åˆå§‹åŒ–æ•°æ®" class="headerlink" title="é…ç½®åˆå§‹åŒ–æ•°æ®"></a>é…ç½®åˆå§‹åŒ–æ•°æ®</h2><p>createStore() çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„, ç”¨äºè®¾ç½® state åˆå§‹çŠ¶æ€ã€‚è¿™å¯¹å¼€å‘åº”ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼ŒæœåŠ¡å™¨ç«¯ redux åº”ç”¨çš„ state ç»“æ„å¯ä»¥ä¸å®¢æˆ·ç«¯ä¿æŒä¸€è‡´, é‚£ä¹ˆå®¢æˆ·ç«¯å¯ä»¥å°†ä»ç½‘ç»œæ¥æ”¶åˆ°çš„æœåŠ¡ç«¯ state ç›´æ¥ç”¨äºæœ¬åœ°æ•°æ®åˆå§‹åŒ–ã€‚<br>letstore=createStore(reducer,window.STATE_FROM_SERVER)</p>
<h2 id="æ·»åŠ ç›‘å¬"><a href="#æ·»åŠ ç›‘å¬" class="headerlink" title="æ·»åŠ ç›‘å¬"></a>æ·»åŠ ç›‘å¬</h2><p>å½“ä»“åº“çŠ¶æ€æ”¹å˜æ—¶ï¼Œé¡µé¢æ•°æ®ä¹Ÿéœ€è¦éšç€æ”¹å˜ï¼Œé€šè¿‡ subscribe ç›‘å¬æ•°æ®å˜åŒ–ï¼Œå¹¶ç»‘å®šåˆ°è§†å›¾</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.getElementById(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> render = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  ReactDOM.render(template, element);</span><br><span class="line">&#125;;</span><br><span class="line">render();</span><br><span class="line"><span class="comment">//åªèƒ½ç›‘å¬ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥å¯¹renderæ–¹æ³•æ”¹é€ </span></span><br><span class="line">store.subcribe(render);</span><br></pre></td></tr></table></figure>

<h2 id="ç§»é™¤ç›‘å¬"><a href="#ç§»é™¤ç›‘å¬" class="headerlink" title="ç§»é™¤ç›‘å¬"></a>ç§»é™¤ç›‘å¬</h2><p>åˆ›å»ºç›‘å¬åï¼Œstore.subscribe() å°†è¿”å›ä¸€ä¸ªå‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå³å¯ç§»é™¤å¯¹è§†å›¾ç›‘å¬</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unsubscribe = store.subscribe(listener);</span><br><span class="line">unsubscribe();</span><br></pre></td></tr></table></figure>

<h1 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h1><p>Action æ˜¯æŠŠæ•°æ®ä»åº”ç”¨ä¼ åˆ° store çš„æœ‰æ•ˆè½½è·ã€‚ <strong>å®ƒæ˜¯ store æ•°æ®çš„å”¯ä¸€æ¥æºã€‚</strong> ä¸€èˆ¬æ¥è¯´ä½ ä¼šé€šè¿‡ store.dispatch() å°† action ä¼ åˆ° storeã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ADD_TODO = <span class="string">&#x27;ADD_TODO&#x27;</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: ADD_TODO,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;Build my first Redux app&#x27;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Action æœ¬è´¨ä¸Šæ˜¯ JavaScript æ™®é€šå¯¹è±¡ã€‚æˆ‘ä»¬çº¦å®šï¼Œaction å†…å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ type å­—æ®µæ¥è¡¨ç¤ºå°†è¦æ‰§è¡Œçš„åŠ¨ä½œã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œtype ä¼šè¢«å®šä¹‰æˆå­—ç¬¦ä¸²å¸¸é‡ã€‚å½“åº”ç”¨è§„æ¨¡è¶Šæ¥è¶Šå¤§æ—¶ï¼Œå»ºè®®ä½¿ç”¨å•ç‹¬çš„æ¨¡å—æˆ–æ–‡ä»¶æ¥å­˜æ”¾ actionã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PLUS, MINUS &#125; <span class="keyword">from</span> <span class="string">&quot;./store/action&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>é™¤äº† type å­—æ®µå¤–ï¼Œaction å¯¹è±¡çš„ç»“æ„å®Œå…¨ç”±ä½ è‡ªå·±å†³å®šã€‚å‚ç…§ Flux æ ‡å‡† Action è·å–å…³äºå¦‚ä½•æ„é€  action çš„å»ºè®®ã€‚<br>è¿™æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æ·»åŠ ä¸€ä¸ª action index æ¥è¡¨ç¤ºç”¨æˆ·å®Œæˆä»»åŠ¡çš„åŠ¨ä½œåºåˆ—å·ã€‚å› ä¸ºæ•°æ®æ˜¯å­˜æ”¾åœ¨æ•°ç»„ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¸‹æ ‡ index æ¥å¼•ç”¨ç‰¹å®šçš„ä»»åŠ¡ã€‚è€Œå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¼šåœ¨æ–°å»ºæ•°æ®çš„æ—¶å€™ç”Ÿæˆå”¯ä¸€çš„ ID ä½œä¸ºæ•°æ®çš„å¼•ç”¨æ ‡è¯†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;PLUS&quot;</span>,</span><br><span class="line">      <span class="attr">index</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘åœ¨ action ä¸­ä¼ é€’çš„æ•°æ®ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œä¼ é€’ index å°±æ¯”æŠŠæ•´ä¸ªä»»åŠ¡å¯¹è±¡ä¼ è¿‡å»è¦å¥½ã€‚<br>æœ€åï¼Œå†æ·»åŠ ä¸€ä¸ª action type æ¥è¡¨ç¤ºå½“å‰çš„ä»»åŠ¡å±•ç¤ºé€‰é¡¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">type</span>: SET_VISIBILITY_FILTER,</span><br><span class="line">    <span class="attr">filter</span>: SHOW_COMPLETED</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‘èµ·-Action"><a href="#å‘èµ·-Action" class="headerlink" title="å‘èµ· Action"></a>å‘èµ· Action</h2><p>é€šè¿‡ dispatch()æ¥å‘èµ·ä¸€ä¸ª Action, æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­æœ‰ type,payload</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;PLUS&quot;</span>, <span class="attr">payload</span>: [something] &#125;);</span><br></pre></td></tr></table></figure>

<h1 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h1><p>æŒ‡å®šäº†åº”ç”¨çŠ¶æ€çš„å˜åŒ–å¦‚ä½•å“åº” actions å¹¶å‘é€åˆ° store çš„ reducer æ¥æ”¶æ—§çš„ state å’Œ actionï¼Œè¿”å›æ–°çš„ stateã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = defaultState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type, payload &#125; = action;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;PLUS&quot;</span>:</span><br><span class="line">      <span class="comment">//å†™æ³•ä¸€ï¼š</span></span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">count</span>: state.count + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;MINUS&quot;</span>:</span><br><span class="line">      <span class="comment">//å†™æ³•äºŒï¼š</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class="line">        <span class="attr">count</span>: state.count - <span class="number">1</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p><strong>æ°¸è¿œä¸è¦åœ¨ reducer é‡Œåšè¿™äº›æ“ä½œï¼š</strong></p>
<ul>
<li>ä¿®æ”¹ä¼ å…¥å‚æ•°</li>
<li>æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œå¦‚ API è¯·æ±‚å’Œè·¯ç”±è·³è½¬</li>
<li>è°ƒç”¨éçº¯å‡½æ•°ï¼Œå¦‚ Date.now() æˆ– Math.random()</li>
</ul>
<h2 id="çº¯å‡½æ•°"><a href="#çº¯å‡½æ•°" class="headerlink" title="çº¯å‡½æ•°"></a>çº¯å‡½æ•°</h2><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ</h2><p>å½“æˆ‘ä»¬çš„ç¨‹åºå˜å¾—åºå¤§çš„æ—¶å€™, å°†ä¸å¯é¿å…åœ°å¼•å‘ä¸€äº› bugsã€‚æˆ‘ä»¬ä¸èƒ½ä¿è¯æœç» bug äº§ç”Ÿ, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸäº›ç¼–ç¨‹æ–¹å¼æ¥å‡å°‘ä¸€äº›é”™è¯¯çš„å‘ç”Ÿã€‚<br>çº¯å‡½æ•°å°±æ˜¯å…¶ä¸­ä¸€ç§,å®ƒä¹Ÿæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­ä¸€éƒ¨åˆ†ã€‚é‚£å®ƒä¸ºä»€ä¹ˆå¯ä»¥èµ·åˆ°å‡å°‘ bug çš„ä½œç”¨å‘¢, åŸå› å°±åœ¨äºèƒ½è¢«ç§°ä¹‹ä¸ºçº¯å‡½æ•°è€Œåˆ¶å®šçš„ä¸€äº›åŸåˆ™ï¼Œæˆ‘ä»¬æ¥ç®€å•çœ‹ä¸‹<br><strong>3 ä¸ªåŸåˆ™ï¼š</strong></p>
<ul>
<li>å˜é‡éƒ½åªåœ¨å‡½æ•°ä½œç”¨åŸŸå†…è·å–, ä½œä¸ºçš„å‡½æ•°çš„å‚æ•°ä¼ å…¥</li>
<li><strong>ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨</strong>(side effects), ä¸ä¼šæ”¹å˜è¢«ä¼ å…¥çš„æ•°æ®æˆ–è€…å…¶ä»–æ•°æ®</li>
<li>ç›¸åŒçš„è¾“å…¥ <strong>ä¸€å®š</strong> ä¿è¯ç›¸åŒçš„è¾“å‡º(same input -&gt; same ouput)</li>
</ul>
<h2 id="çº¯å‡½æ•°çš„ä¸€äº›ä¼˜ç‚¹"><a href="#çº¯å‡½æ•°çš„ä¸€äº›ä¼˜ç‚¹" class="headerlink" title="çº¯å‡½æ•°çš„ä¸€äº›ä¼˜ç‚¹"></a>çº¯å‡½æ•°çš„ä¸€äº›ä¼˜ç‚¹</h2><ul>
<li>å®¹æ˜“æµ‹è¯•(testable)</li>
<li>å› ä¸ºç›¸åŒçš„è¾“å…¥å¿…å®šæ˜¯ç›¸åŒçš„è¾“å‡ºï¼Œå› æ­¤ç»“æœå¯ä»¥ç¼“å­˜(cacheable)</li>
<li>è‡ªæˆ‘è®°å½•(Self documenting),å› ä¸ºéœ€è¦çš„å˜é‡éƒ½æ˜¯å‚æ•°ï¼Œå‚æ•°å‘½åè‰¯å¥½çš„æƒ…å†µä¸‹å³ä¾¿å¾ˆä¹…ä»¥åå†å»çœ‹è¿™ä¸ªå‡½æ•°ä¾æ—§å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“è¿™ä¸ªå‡½æ•°éœ€è¦å“ªäº›å‚æ•°</li>
<li>å› ä¸ºä¸ç”¨æ‹…å¿ƒæœ‰å‰¯ä½œç”¨(side-effects),å› æ­¤å¯ä»¥æ›´å¥½åœ°å·¥ä½œ</li>
</ul>
<h2 id="åˆå¹¶-reducer"><a href="#åˆå¹¶-reducer" class="headerlink" title="åˆå¹¶ reducer"></a>åˆå¹¶ reducer</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>å½“æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘è¶³å¤Ÿå¤æ‚çš„æ—¶å€™ï¼Œä¸€ä¸ªå…¨å±€çš„ state å·²ç»ä¸èƒ½å¾ˆå¥½ç»´æŒæ¯ä¸ªé¡µé¢ä¸­çš„å…±äº«æ•°æ®ï¼Œè¿«åˆ‡çš„éœ€è¦è¿›è¡Œä½œç”¨åŸŸéš”ç¦» combineReducers å‡½æ•°åº”ç”¨è€Œç”Ÿ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> reducer1 = <span class="function">()=&gt;</span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> reducer2 = <span class="function">()=&gt;</span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> Reducers  = combineReducers(&#123;</span><br><span class="line">        <span class="attr">reducer1</span>:reducer1,</span><br><span class="line">        reducer2,</span><br><span class="line">        ...</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="æºç å®ç°"><a href="#æºç å®ç°" class="headerlink" title="æºç å®ç°"></a>æºç å®ç°</h2><h4 id="store-index-js"><a href="#store-index-js" class="headerlink" title="store/index.js"></a>store/index.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redux</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">reducer</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.reducer = reducer;</span><br><span class="line">    <span class="built_in">this</span>.listener = [];</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="number">19</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> instance;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">createStore</span>(<span class="params">reducer</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.instance) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.instance;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="built_in">this</span>.instance = <span class="keyword">new</span> Redux(reducer));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è§¦å‘dispatchäº‹ä»¶</span></span><br><span class="line">  <span class="function"><span class="title">dispatch</span>(<span class="params">action</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> state = <span class="built_in">this</span>.reducer(<span class="built_in">this</span>.state, action);</span><br><span class="line">    <span class="comment">// å‘å¸ƒ</span></span><br><span class="line">    <span class="built_in">this</span>.listener.forEach(<span class="function">(<span class="params">listen</span>) =&gt;</span> &#123;</span><br><span class="line">      listen(state);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è·å–state</span></span><br><span class="line">  <span class="function"><span class="title">getStore</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.state;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¸è½½redux</span></span><br><span class="line">  <span class="function"><span class="title">remove</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.instance = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç›‘å¬</span></span><br><span class="line">  <span class="function"><span class="title">subscribe</span>(<span class="params">fn</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ è®¢é˜…è€…</span></span><br><span class="line">    <span class="built_in">this</span>.listener.push(fn);</span><br><span class="line">    <span class="comment">// è¿”å›å¸è½½çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.remove;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function"><span class="keyword">function</span> (<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">      state.name += <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Redux.createStore(reducer);</span><br></pre></td></tr></table></figure>

<h4 id="é¡µé¢çš„è°ƒç”¨"><a href="#é¡µé¢çš„è°ƒç”¨" class="headerlink" title="é¡µé¢çš„è°ƒç”¨"></a>é¡µé¢çš„è°ƒç”¨</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Store <span class="keyword">from</span> <span class="string">&quot;../store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comp1</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">name</span>: Store.getStore().name,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//ç›‘å¬äº‹ä»¶</span></span><br><span class="line">    Store.subscribe(<span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        <span class="attr">name</span>: state.name,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Comp1 &#123;this.state.name&#125;</span></span><br><span class="line"><span class="xml">				&#123;//ç‚¹å‡»äº‹ä»¶è§¦å‘dispatch &#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> Store.dispatch(&#123; type: &quot;add&quot; &#125;)&#125;&gt;ç‚¹æˆ‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Comp1;</span><br></pre></td></tr></table></figure>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/zfb-pay.png"><img loading="lazy" src="/images/zfb-pay.png" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/qq-pay.png"><img loading="lazy" src="/images/qq-pay.png" alt="QQ æ”¯ä»˜" title="QQ æ”¯ä»˜"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wx-pay.png"><img loading="lazy" src="/images/wx-pay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div><div><img loading="lazy" src="/images/wantthis.gif" alt="æƒ³è¦è¿™ä¸ª" title="ä¼¸æ‰‹è¦é’±"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>å½©é¹</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://blog.gaocaipeng.com/2020/06/28/ufmyxp/" title="React - Redux">https://blog.gaocaipeng.com/2020/06/28/ufmyxp/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/06/29/cgofeg/" rel="prev" title="Redux - saga"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Redux - saga</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/06/26/tb3bz4/" rel="next" title="Vue - è‡ªå®šä¹‰ç»„ä»¶"><span class="post-nav-text">Vue - è‡ªå®šä¹‰ç»„ä»¶</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è¦ä¸è¦å’Œæˆ‘è¯´äº›ä»€ä¹ˆï¼Ÿ</span><br></div><div id="tcomment"></div><script src="https://cdn.jsdelivr.net/npm/twikoo@latest/dist/twikoo.all.min.js"></script><script>const twikooConfig = {"enable":true,"envId":"twikoo-1gdwtrnc57e907a9"}
twikooConfig.el = '#tcomment'
twikoo.init(twikooConfig)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> å½©é¹</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div><div class="live_time"><span>æœ¬åšå®¢å·²èŒèŒå“’åœ°è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-04-26T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " å¤© " + passHour + " å°æ—¶ " + passMinute + " åˆ† " + passSecond + " ç§’";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""><div><img style="margin:0em 0em 0.1em 0em" loading="lazy" src="/images/run.gif" alt="æ¥æœç´¢å•Š" width="200px" title="wait a moment"></div></div><div id="local-search-result"></div></div><script>const date = new Date();
const today = (date.getMonth() + 1) + "-" + date.getDate()
const mourn_days = ["4-4"]
if (mourn_days.includes(today)) {
  document.documentElement.style.filter = "grayscale(1)";
}</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"live2d-widget-model-haruto"},"display":{"superSample":2,"width":160,"height":240,"position":"right","hOffset":20,"vOffset":50},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>